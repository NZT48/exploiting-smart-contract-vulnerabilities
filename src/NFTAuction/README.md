# Exploit NFT auction

## Prerequisites

1. Visit (remix.ethereum.org)[https://remix.ethereum.org]
2. Add the following files: NFT.sol, NFTAuction.sol and ExploitAuction.sol

## Steps for executing attack

1. Switch to the tab 'Deploy & run transactions'
2. While the NFT.sol file is open, choose ERC721 - NFT.sol in the drop down menu and click on deploy button. The newly deployed contract will be shown below.
2. Call ERC721-Mint function and setup caller address and 1 for tokenId
3. While NFTAuction.sol file is open, choose NFTAuction - NFTAuction.sol in the dropdown menu and setup ERC721 address for address in constructor and 1 for tokenId
4. Call ERC721-Approve function and setup address of NFTAuction contract and 1 for token ID. With this call we will give NFTAuction privileges to manage our NFT
5. Call NFTAuction-Start to start the auction
6. Bid #1 - We choose a wallet, setup value to 2 Eth and call NFTAuction-Bid function to enter the auction
7. Call NFTAuction-HighestBidder to confirm that we are leaders in the auction
8. While the ExploitAuction.sol file is open, choose ExploitNFTAuction - ExploitAuction.sol in the dropdown menu and setup NFTAuction address for address in constructor
9. Bid #2 - Call ExploitNFTAuction-makeBid function with 3 Eth
10. Call NFTAuction-HighestBidder to confirm that the exploiting contract is the highest bidder in the auction
11. Bid #3 - We choose a third wallet, set the value to 4 Eth and call NFTAuction-Bid function to take the lead
12. Now we can get back our money from auction because we are no more leading in the auction, and attacker will use this opportunity to steal all the money from the contract. Attacker will call ExploitNFTAuction-exploit so he can steal all the EthersThe attacker
13. Call ExploitNFTAuction-RetrieveStolenFunds to get money from the attacking contract into your wallet

## Sequence diagram of reentrancy

![](../../images/reentrancy.png)
