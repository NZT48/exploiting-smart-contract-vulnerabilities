# Exploit giveaway

## Prerequisites

1. Visit (remix.ethereum.org)[https://remix.ethereum.org]
2. Add the following files:  lib.sol, giveaway.sol, exploitSelfdestruct.sol, exploitGiveaway.sol

## Steps for executing attack

1. Switch to the tab 'Deploy & run transactions'
2.  While the lib.sol file is open, choose Lib in the drop down menu and click on deploy button. The newly deployed contract will be shown below.
3. While the giveaway.sol file is open, choose Giveaway in the drop down menu, set Lib contract address as constructor parameter and click on deploy button. The newly deployed contract will be shown below.
4. Set 1 Eth as value and call Giveaway-enterGiveaway function
5. While the exploitSelfdestruct.sol file is open, choose ExploitSelfdestruct in the drop down menu, set Giveaway contract address as constructor param and click on deploy button. The newly deployed contract will be shown below.
6. Call ExploitSelfdesturct-exploit function with 10 Eth
	* it is important to have number of eth in this call plus the number on contract to be larger then 20 Eth
7. Set 1 Eth as value and call Giveaway-enterGiveaway function
	* We will get error: 'The transaction has been reverted to the initial state. Reason provided by the contract: "Game is over".'
	* Nobody can enter the giveaway anymore because we blocked the giveaway contract by sending eth over expected limit
8. Call Giveaway-getBalance function to check that the contract balance is greater then 20 Eth 
9. Call Giveaway-winner function to see that there is no winner set (0x00 address is in winner variable)
10. While the exploitGiveaway.sol file is open, choose Exploit in the drop down menu, set Giveaway contract address as constructor param and click on deploy button. The newly deployed contract will be shown below.
11. Call ExploitGiveaway-exploit function to setup attackers contract to be used insted the Lib contract in the Giveaway contract, and then it will set itself as winner of giveaway
12. Call ExploitGiveaway-getBalance to see that we have stolen 21 Eth from Giveaway contract
13. Call ExploitGiveaway-retrieveStolenFunds 
	* With this call we will get all the money from attacker contract to our wallet
	
## Attack sequence diagram

![](../../images/delegatecall_attack_flow.png)
